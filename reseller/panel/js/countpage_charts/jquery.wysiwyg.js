!function(t){"use strict";function e(){this.controls={bold:{groupIndex:0,visible:!0,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold",hotkey:{ctrl:1,key:66}},copy:{groupIndex:8,visible:!1,tooltip:"Copy"},createLink:{groupIndex:6,visible:!0,exec:function(){var e=this;t.wysiwyg.controls&&t.wysiwyg.controls.link?t.wysiwyg.controls.link.init(this):t.wysiwyg.autoload?t.wysiwyg.autoload.control("wysiwyg.link.js",function(){e.controls.createLink.exec.apply(e)}):i.error("$.wysiwyg.controls.link not defined. You need to include wysiwyg.link.js file")},tags:["a"],tooltip:"Create link"},cut:{groupIndex:8,visible:!1,tooltip:"Cut"},decreaseFontSize:{groupIndex:9,visible:!1,tags:["small"],tooltip:"Decrease font size",exec:function(){this.decreaseFontSize()}},h1:{groupIndex:7,visible:!0,className:"h1",command:t.browser.msie||t.browser.safari?"FormatBlock":"heading",arguments:t.browser.msie||t.browser.safari?"<h1>":"h1",tags:["h1"],tooltip:"Header 1"},h2:{groupIndex:7,visible:!0,className:"h2",command:t.browser.msie||t.browser.safari?"FormatBlock":"heading",arguments:t.browser.msie||t.browser.safari?"<h2>":"h2",tags:["h2"],tooltip:"Header 2"},h3:{groupIndex:7,visible:!0,className:"h3",command:t.browser.msie||t.browser.safari?"FormatBlock":"heading",arguments:t.browser.msie||t.browser.safari?"<h3>":"h3",tags:["h3"],tooltip:"Header 3"},highlight:{tooltip:"Highlight",className:"highlight",groupIndex:1,visible:!1,css:{backgroundColor:"rgb(255, 255, 102)"},exec:function(){var e,i,o,n;if(e=t.browser.msie||t.browser.safari?"backcolor":"hilitecolor",t.browser.msie)i=this.getInternalRange().parentElement();else for(o=this.getInternalSelection(),i=o.extentNode||o.focusNode;void 0===i.style;)if(i=i.parentNode,i.tagName&&"body"===i.tagName.toLowerCase())return;n="rgb(255, 255, 102)"===i.style.backgroundColor||"#ffff66"===i.style.backgroundColor?"#ffffff":"#ffff66",this.editorDoc.execCommand(e,!1,n)}},html:{groupIndex:10,visible:!1,exec:function(){var e;this.options.resizeOptions&&t.fn.resizable&&(e=this.element.height()),this.viewHTML?(this.setContent(this.original.value),t(this.original).hide(),this.editor.show(),this.options.resizeOptions&&t.fn.resizable&&(e===this.element.height()&&this.element.height(e+this.editor.height()),this.element.resizable(t.extend(!0,{alsoResize:this.editor},this.options.resizeOptions))),this.ui.toolbar.find("li").each(function(){var e=t(this);e.removeClass(e.hasClass("html")?"active":"disabled")})):(this.saveContent(),t(this.original).css({width:this.element.outerWidth()-6,height:this.element.height()-this.ui.toolbar.height()-6,resize:"none"}).show(),this.editor.hide(),this.options.resizeOptions&&t.fn.resizable&&(e===this.element.height()&&this.element.height(this.ui.toolbar.height()),this.element.resizable("destroy")),this.ui.toolbar.find("li").each(function(){var e=t(this);e.hasClass("html")?e.addClass("active"):!1===e.hasClass("fullscreen")&&e.removeClass("active").addClass("disabled")})),this.viewHTML=!this.viewHTML},tooltip:"View source code"},increaseFontSize:{groupIndex:9,visible:!1,tags:["big"],tooltip:"Increase font size",exec:function(){this.increaseFontSize()}},indent:{groupIndex:2,visible:!0,tooltip:"Indent"},insertHorizontalRule:{groupIndex:6,visible:!0,tags:["hr"],tooltip:"Insert Horizontal Rule"},insertImage:{groupIndex:6,visible:!0,exec:function(){var e=this;t.wysiwyg.controls&&t.wysiwyg.controls.image?t.wysiwyg.controls.image.init(this):t.wysiwyg.autoload?t.wysiwyg.autoload.control("wysiwyg.image.js",function(){e.controls.insertImage.exec.apply(e)}):i.error("$.wysiwyg.controls.image not defined. You need to include wysiwyg.image.js file")},tags:["img"],tooltip:"Insert image"},insertOrderedList:{groupIndex:5,visible:!0,tags:["ol"],tooltip:"Insert Ordered List"},insertTable:{groupIndex:6,visible:!0,exec:function(){var e=this;t.wysiwyg.controls&&t.wysiwyg.controls.table?t.wysiwyg.controls.table(this):t.wysiwyg.autoload?t.wysiwyg.autoload.control("wysiwyg.table.js",function(){e.controls.insertTable.exec.apply(e)}):i.error("$.wysiwyg.controls.table not defined. You need to include wysiwyg.table.js file")},tags:["table"],tooltip:"Insert table"},insertUnorderedList:{groupIndex:5,visible:!0,tags:["ul"],tooltip:"Insert Unordered List"},italic:{groupIndex:0,visible:!0,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic",hotkey:{ctrl:1,key:73}},justifyCenter:{groupIndex:1,visible:!0,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyFull:{groupIndex:1,visible:!0,css:{textAlign:"justify"},tooltip:"Justify Full"},justifyLeft:{visible:!0,groupIndex:1,css:{textAlign:"left"},tooltip:"Justify Left"},justifyRight:{groupIndex:1,visible:!0,css:{textAlign:"right"},tooltip:"Justify Right"},ltr:{groupIndex:10,visible:!1,exec:function(){var e=this.dom.getElement("p");return e?(t(e).attr("dir","ltr"),!0):!1},tooltip:"Left to Right"},outdent:{groupIndex:2,visible:!0,tooltip:"Outdent"},paragraph:{groupIndex:7,visible:!1,className:"paragraph",command:"FormatBlock",arguments:t.browser.msie||t.browser.safari?"<p>":"p",tags:["p"],tooltip:"Paragraph"},paste:{groupIndex:8,visible:!1,tooltip:"Paste"},redo:{groupIndex:4,visible:!0,tooltip:"Redo"},removeFormat:{groupIndex:10,visible:!0,exec:function(){this.removeFormat()},tooltip:"Remove formatting"},rtl:{groupIndex:10,visible:!1,exec:function(){var e=this.dom.getElement("p");return e?(t(e).attr("dir","rtl"),!0):!1},tooltip:"Right to Left"},strikeThrough:{groupIndex:0,visible:!0,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},subscript:{groupIndex:3,visible:!0,tags:["sub"],tooltip:"Subscript"},superscript:{groupIndex:3,visible:!0,tags:["sup"],tooltip:"Superscript"},underline:{groupIndex:0,visible:!0,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline",hotkey:{ctrl:1,key:85}},undo:{groupIndex:4,visible:!0,tooltip:"Undo"},code:{visible:!0,groupIndex:6,tooltip:"Code snippet",exec:function(){var e=this.getInternalRange(),i=t(e.commonAncestorContainer),o=e.commonAncestorContainer.nodeName.toLowerCase();i.parent("code").length?i.unwrap():"body"!==o&&i.wrap("<code/>")}},cssWrap:{visible:!1,groupIndex:6,tooltip:"CSS Wrapper",exec:function(){t.wysiwyg.controls.cssWrap.init(this)}}},this.defaults={html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" style="margin:0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body style="margin:0;">INITIAL_CONTENT</body></html>',debug:!1,controls:{},css:{},events:{},autoGrow:!1,autoSave:!0,brIE:!0,formHeight:270,formWidth:440,iFrameClass:null,initialContent:"",maxHeight:1e4,maxLength:0,messages:{nonSelection:"Select the text you wish to link"},toolbarHtml:'<ul role="menu" class="toolbar"></ul>',removeHeadings:!1,replaceDivWithP:!1,resizeOptions:!1,rmUnusedControls:!1,rmUnwantedBr:!0,tableFiller:"Lorem ipsum",initialMinHeight:null,controlImage:{forceRelativeUrls:!1},controlLink:{forceRelativeUrls:!1},plugins:{autoload:!1,i18n:!1,rmFormat:{rmMsWordMarkup:!1}},dialog:"default"},this.availableControlProperties=["arguments","callback","className","command","css","custom","exec","groupIndex","hotkey","icon","tags","tooltip","visible"],this.editor=null,this.editorDoc=null,this.element=null,this.options={},this.original=null,this.savedRange=null,this.timers=[],this.validKeyCodes=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46],this.isDestroyed=!1,this.dom={ie:{parent:null},w3c:{parent:null}},this.dom.parent=this,this.dom.ie.parent=this.dom,this.dom.w3c.parent=this.dom,this.ui={},this.ui.self=this,this.ui.toolbar=null,this.ui.initialHeight=null,this.dom.getAncestor=function(t,e){for(e=e.toLowerCase();t&&"undefined"!=typeof t.tagName&&"body"!==t.tagName.toLowerCase();){if(e===t.tagName.toLowerCase())return t;t=t.parentNode}if(!t.tagName&&(t.previousSibling||t.nextSibling)){if(t.previousSibling&&t.previousSibling.tagName.toLowerCase()==e)return t.previousSibling;if(t.nextSibling&&t.nextSibling.tagName.toLowerCase()==e)return t.nextSibling}return null},this.dom.getElement=function(t){var e=this;return t=t.toLowerCase(),window.getSelection?e.w3c.getElement(t):e.ie.getElement(t)},this.dom.ie.getElement=function(t){var e,i=this.parent,o=i.parent.getInternalSelection(),n=o.createRange();if("Control"===o.type){if(1!==n.length)return null;e=n.item(0)}else e=n.parentElement();return i.getAncestor(e,t)},this.dom.w3c.getElement=function(t){var e,i=this.parent,o=i.parent.getInternalRange();if(!o)return null;if(e=o.commonAncestorContainer,3===e.nodeType&&(e=e.parentNode),e===o.startContainer&&(e=e.childNodes[o.startOffset]),!e.tagName&&(e.previousSibiling||e.nextSibling)){if(e.previousSibiling&&e.previousSibiling.tagName.toLowerCase()==t)return e.previousSibiling;if(e.nextSibling&&e.nextSibling.tagName.toLowerCase()==t)return e.nextSibling}return i.getAncestor(e,t)},this.ui.addHoverClass=function(){t(this).addClass("wysiwyg-button-hover")},this.ui.appendControls=function(){var e,i,o=this,n=this.self,s=n.parseControls(),r=!0,a=[],l={},c=function(t,e){e.groupIndex&&i!==e.groupIndex&&(i=e.groupIndex,r=!1),e.visible&&(r||(o.appendItemSeparator(),r=!0),e.custom?o.appendItemCustom(t,e):o.appendItem(t,e))};for(t.each(s,function(t,e){var i="empty";void 0!==e.groupIndex&&(i=""===e.groupIndex?"empty":e.groupIndex),void 0===l[i]&&(a.push(i),l[i]={}),l[i][t]=e}),a.sort(function(t,e){return"number"==typeof t&&typeof t==typeof e?t-e:(t=t.toString(),e=e.toString(),t>e?1:t===e?0:-1)}),0<a.length&&(i=a[0]),e=0;e<a.length;e+=1)t.each(l[a[e]],c)},this.ui.appendItem=function(e,i){var o=this.self,n=i.className||i.command||e||"empty",s=i.tooltip||i.command||e||"";return t('<li role="menuitem" unselectable="on">'+n+"</li>").addClass(n).attr("title",s).hover(this.addHoverClass,this.removeHoverClass).click(function(){return t(this).hasClass("disabled")?!1:(o.triggerControl.apply(o,[e,i]),this.blur(),o.ui.returnRange(),o.ui.focus(),!0)}).appendTo(o.ui.toolbar)},this.ui.appendItemCustom=function(e,i){var o=this.self,n=i.tooltip||i.command||e||"";return i.callback&&t(window).bind("trigger-"+e+".wysiwyg",i.callback),t('<li role="menuitem" unselectable="on" style="background: url(\''+i.icon+"') no-repeat;\"></li>").addClass("custom-command-"+e).addClass("wysiwyg-custom-command").addClass(e).attr("title",n).hover(this.addHoverClass,this.removeHoverClass).click(function(){return t(this).hasClass("disabled")?!1:(o.triggerControl.apply(o,[e,i]),this.blur(),o.ui.returnRange(),o.ui.focus(),o.triggerControlCallback(e),!0)}).appendTo(o.ui.toolbar)},this.ui.appendItemSeparator=function(){var e=this.self;return t('<li role="separator" class="separator"></li>').appendTo(e.ui.toolbar)},this.autoSaveFunction=function(){this.saveContent()},this.ui.checkTargets=function(e){var i=this.self;t.each(i.options.controls,function(o,n){var s,r,a,l,c=n.className||n.command||o||"empty",d=function(t,e){var o;"function"==typeof e?(o=e,o(l.css(t).toString().toLowerCase(),i)&&i.ui.toolbar.find("."+c).addClass("active")):l.css(t).toString().toLowerCase()===e&&i.ui.toolbar.find("."+c).addClass("active")};if("fullscreen"!==c&&i.ui.toolbar.find("."+c).removeClass("active"),n.tags||n.options&&n.options.tags)for(s=n.tags||n.options&&n.options.tags,r=e;r&&1===r.nodeType;)-1!==t.inArray(r.tagName.toLowerCase(),s)&&i.ui.toolbar.find("."+c).addClass("active"),r=r.parentNode;if(n.css||n.options&&n.options.css)for(a=n.css||n.options&&n.options.css,l=t(e);l&&1===l[0].nodeType;)t.each(a,d),l=l.parent()})},this.ui.designMode=function(){var t,e=3,i=this.self;(t=function(e){if("on"===i.editorDoc.designMode)return i.timers.designMode&&window.clearTimeout(i.timers.designMode),void(i.innerDocument()!==i.editorDoc&&i.ui.initFrame());try{i.editorDoc.designMode="on"}catch(o){}e-=1,e>0&&(i.timers.designMode=window.setTimeout(function(){t(e)},100))})(e)},this.destroy=function(){this.isDestroyed=!0;var e,i=this.element.closest("form");for(e=0;e<this.timers.length;e+=1)window.clearTimeout(this.timers[e]);return i.unbind(".wysiwyg"),this.element.remove(),t.removeData(this.original,"wysiwyg"),t(this.original).show(),this},this.getRangeText=function(){var t=this.getInternalRange();return t.toString?t=t.toString():t.text&&(t=t.text),t},this.execute=function(t,e){"undefined"==typeof e&&(e=null),this.editorDoc.execCommand(t,!1,e)},this.extendOptions=function(e){var i={};return"object"==typeof e.controls&&(i=e.controls,delete e.controls),e=t.extend(!0,{},this.defaults,e),e.controls=t.extend(!0,{},i,this.controls,i),e.rmUnusedControls&&t.each(e.controls,function(t){i[t]||delete e.controls[t]}),e},this.ui.focus=function(){var t=this.self;return t.editor.get(0).contentWindow.focus(),t},this.ui.returnRange=function(){var t,e=this.self;if(null!==e.savedRange){if(window.getSelection){t=window.getSelection(),t.rangeCount>0&&t.removeAllRanges();try{t.addRange(e.savedRange)}catch(o){i.error(o)}}else window.document.createRange?window.getSelection().addRange(e.savedRange):window.document.selection&&e.savedRange.select();e.savedRange=null}},this.increaseFontSize=function(){if(t.browser.mozilla||t.browser.opera)this.editorDoc.execCommand("increaseFontSize",!1,null);else if(t.browser.safari){var e=this.getInternalRange(),o=this.getInternalSelection(),n=this.editorDoc.createElement("big");if(!0===e.collapsed&&3===e.commonAncestorContainer.nodeType){var s=e.commonAncestorContainer.nodeValue.toString(),r=s.lastIndexOf(" ",e.startOffset)+1,a=-1===s.indexOf(" ",e.startOffset)?s:s.indexOf(" ",e.startOffset);e.setStart(e.commonAncestorContainer,r),e.setEnd(e.commonAncestorContainer,a),e.surroundContents(n),o.addRange(e)}else e.surroundContents(n),o.removeAllRanges(),o.addRange(e)}else i.error("Internet Explorer?")},this.decreaseFontSize=function(){if(t.browser.mozilla||t.browser.opera)this.editorDoc.execCommand("decreaseFontSize",!1,null);else if(t.browser.safari){var e=this.getInternalRange(),o=this.getInternalSelection(),n=this.editorDoc.createElement("small");if(!0===e.collapsed&&3===e.commonAncestorContainer.nodeType){var s=e.commonAncestorContainer.nodeValue.toString(),r=s.lastIndexOf(" ",e.startOffset)+1,a=-1===s.indexOf(" ",e.startOffset)?s:s.indexOf(" ",e.startOffset);e.setStart(e.commonAncestorContainer,r),e.setEnd(e.commonAncestorContainer,a),e.surroundContents(n),o.addRange(e)}else e.surroundContents(n),o.removeAllRanges(),o.addRange(e)}else i.error("Internet Explorer?")},this.getContent=function(){return this.viewHTML&&this.setContent(this.original.value),this.events.filter("getContent",this.editorDoc.body.innerHTML)},this.events={_events:{},bind:function(t,e){"object"!=typeof this._events.eventName&&(this._events[t]=[]),this._events[t].push(e)},trigger:function(e,i){if("object"==typeof this._events.eventName){var o=this.editor;t.each(this._events[e],function(t,e){"function"==typeof e&&e.apply(o,i)})}},filter:function(e,i){if("object"==typeof this._events[e]){var o=this.editor,n=Array.prototype.slice.call(arguments,1);t.each(this._events[e],function(t,e){"function"==typeof e&&(i=e.apply(o,n))})}return i}},this.getElementByAttributeValue=function(e,i,o){var n,s,r=this.editorDoc.getElementsByTagName(e);for(n=0;n<r.length;n+=1)if(s=r[n].getAttribute(i),t.browser.msie&&(s=s.substr(s.length-o.length)),s===o)return r[n];return!1},this.getInternalRange=function(){var t=this.getInternalSelection();return t?t.rangeCount&&t.rangeCount>0?t.getRangeAt(0):t.createRange?t.createRange():null:null},this.getInternalSelection=function(){if(this.editor.get(0).contentWindow){if(this.editor.get(0).contentWindow.getSelection)return this.editor.get(0).contentWindow.getSelection();if(this.editor.get(0).contentWindow.selection)return this.editor.get(0).contentWindow.selection}return this.editorDoc.getSelection?this.editorDoc.getSelection():this.editorDoc.selection?this.editorDoc.selection:null},this.getRange=function(){var t=this.getSelection();if(!t)return null;if(t.rangeCount&&t.rangeCount>0)t.getRangeAt(0);else if(t.createRange)return t.createRange();return null},this.getSelection=function(){return window.getSelection?window.getSelection():window.document.selection},this.ui.grow=function(){var e=this.self,i=t(e.editorDoc.body),o=t.browser.msie?i[0].scrollHeight:i.height()+2+20,n=e.ui.initialHeight,s=Math.max(o,n);return s=Math.min(s,e.options.maxHeight),e.editor.attr("scrolling",s<e.options.maxHeight?"no":"auto"),i.css("overflow",s<e.options.maxHeight?"hidden":""),e.editor.get(0).height=s,e},this.init=function(e,i){var o=this,n=t(e).closest("form"),s=e.width||e.clientWidth||0,r=e.height||e.clientHeight||0;this.options=this.extendOptions(i),this.original=e,this.ui.toolbar=t(this.options.toolbarHtml),t.browser.msie&&parseInt(t.browser.version,10)<8&&(this.options.autoGrow=!1),0===s&&e.cols&&(s=8*e.cols+21),0===r&&e.rows&&(r=16*e.rows+16),this.editor=t("https:"===window.location.protocol?'<iframe src="javascript:false;"></iframe>':"<iframe></iframe>").attr("frameborder","0"),this.options.iFrameClass?this.editor.addClass(this.options.iFrameClass):(this.editor.css({minHeight:(r-6).toString()+"px",width:s>50?(s-0).toString()+"px":""}),t.browser.msie&&parseInt(t.browser.version,10)<7&&this.editor.css("height",r.toString()+"px")),this.editor.attr("tabindex",t(e).attr("tabindex")),this.element=t("<div/>").addClass("wysiwyg"),this.options.iFrameClass||this.element.css({width:s>0?s.toString()+"px":"100%"}),t(e).hide().before(this.element),this.viewHTML=!1,this.initialContent=t(e).val(),this.ui.initFrame(),this.options.resizeOptions&&t.fn.resizable&&this.element.resizable(t.extend(!0,{alsoResize:this.editor},this.options.resizeOptions)),this.options.autoSave&&n.bind("submit.wysiwyg",function(){o.autoSaveFunction()}),n.bind("reset.wysiwyg",function(){o.resetFunction()})},this.ui.initFrame=function(){var e,i,o,n=this.self;if(n.ui.appendControls(),n.element.append(n.ui.toolbar).append(t("<div><!-- --></div>").css({clear:"both"})).append(n.editor),n.editorDoc=n.innerDocument(),n.isDestroyed)return null;if(n.ui.designMode(),n.editorDoc.open(),n.editorDoc.write(n.options.html.replace(/INITIAL_CONTENT/,function(){return n.wrapInitialContent()})),n.editorDoc.close(),t.wysiwyg.plugin.bind(n),t(n.editorDoc).trigger("initFrame.wysiwyg"),t(n.editorDoc).bind("click.wysiwyg",function(t){n.ui.checkTargets(t.target?t.target:t.srcElement)}),t(n.original).focus(function(){0!==t(this).filter(":visible").length&&n.ui.focus()}),t(n.editorDoc).keydown(function(t){var e;return 8===t.keyCode&&(e=/^<([\w]+)[^>]*>(<br\/?>)?<\/\1>$/,e.test(n.getContent()))?(t.stopPropagation(),!1):!0}),t.browser.msie?n.options.brIE&&t(n.editorDoc).keydown(function(t){if(13===t.keyCode){var e=n.getRange();return e.pasteHTML("<br/>"),e.collapse(!1),e.select(),!1}return!0}):t(n.editorDoc).keydown(function(t){var e;if(t.ctrlKey||t.metaKey)for(e in n.controls)if(n.controls[e].hotkey&&n.controls[e].hotkey.ctrl&&t.keyCode===n.controls[e].hotkey.key)return n.triggerControl.apply(n,[e,n.controls[e]]),!1;return!0}),n.options.plugins.rmFormat.rmMsWordMarkup&&t(n.editorDoc).bind("keyup.wysiwyg",function(e){(e.ctrlKey||e.metaKey)&&86===e.keyCode&&t.wysiwyg.rmFormat&&("object"==typeof n.options.plugins.rmFormat.rmMsWordMarkup?t.wysiwyg.rmFormat.run(n,{rules:{msWordMarkup:n.options.plugins.rmFormat.rmMsWordMarkup}}):t.wysiwyg.rmFormat.run(n,{rules:{msWordMarkup:{enabled:!0}}}))}),n.options.autoSave&&t(n.editorDoc).keydown(function(){n.autoSaveFunction()}).keyup(function(){n.autoSaveFunction()}).mousedown(function(){n.autoSaveFunction()}).bind(t.support.noCloneEvent?"input.wysiwyg":"paste.wysiwyg",function(){n.autoSaveFunction()}),n.options.autoGrow&&(n.ui.initialHeight=null!==n.options.initialMinHeight?n.options.initialMinHeight:t(n.editorDoc).height(),t(n.editorDoc.body).css("border","1px solid white"),i=function(){n.ui.grow()},t(n.editorDoc).keyup(i),t(n.editorDoc).bind("editorRefresh.wysiwyg",i),n.ui.grow()),n.options.css&&(String===n.options.css.constructor?t.browser.msie?(e=n.editorDoc.createStyleSheet(n.options.css),t(e).attr({media:"all"})):(e=t("<link/>").attr({href:n.options.css,media:"all",rel:"stylesheet",type:"text/css"}),t(n.editorDoc).find("head").append(e)):n.timers.initFrame_Css=window.setTimeout(function(){t(n.editorDoc.body).css(n.options.css)},0)),0===n.initialContent.length&&n.setContent("function"==typeof n.options.initialContent?n.options.initialContent():n.options.initialContent),n.options.maxLength>0&&t(n.editorDoc).keydown(function(e){t(n.editorDoc).text().length>=n.options.maxLength&&-1===t.inArray(e.which,n.validKeyCodes)&&e.preventDefault()}),t.each(n.options.events,function(e,i){t(n.editorDoc).bind(e+".wysiwyg",function(t){i.apply(n.editorDoc,[t,n])})}),t.browser.msie?t(n.editorDoc).bind("beforedeactivate.wysiwyg",function(){n.savedRange=n.getInternalRange()}):t(n.editorDoc).bind("blur.wysiwyg",function(){n.savedRange=n.getInternalRange()}),t(n.editorDoc.body).addClass("wysiwyg"),n.options.events&&n.options.events.save&&(o=n.options.events.save,t(n.editorDoc).bind("keyup.wysiwyg",o),t(n.editorDoc).bind("change.wysiwyg",o),t.support.noCloneEvent?t(n.editorDoc).bind("input.wysiwyg",o):(t(n.editorDoc).bind("paste.wysiwyg",o),t(n.editorDoc).bind("cut.wysiwyg",o))),n.options.xhtml5&&n.options.unicode){var s={ne:8800,le:8804,para:182,xi:958,darr:8595,nu:957,oacute:243,Uacute:218,omega:969,prime:8242,pound:163,igrave:236,thorn:254,forall:8704,emsp:8195,lowast:8727,brvbar:166,alefsym:8501,nbsp:160,delta:948,clubs:9827,lArr:8656,Omega:937,Auml:196,cedil:184,and:8743,plusmn:177,ge:8805,raquo:187,uml:168,equiv:8801,laquo:171,rdquo:8221,Epsilon:917,divide:247,fnof:402,chi:967,Dagger:8225,iacute:237,rceil:8969,sigma:963,Oslash:216,acute:180,frac34:190,lrm:8206,upsih:978,Scaron:352,part:8706,exist:8707,nabla:8711,image:8465,prop:8733,zwj:8205,omicron:959,aacute:225,Yuml:376,Yacute:221,weierp:8472,rsquo:8217,otimes:8855,kappa:954,thetasym:977,harr:8596,Ouml:214,Iota:921,ograve:242,sdot:8901,copy:169,oplus:8853,acirc:226,sup:8835,zeta:950,Iacute:205,Oacute:211,crarr:8629,Nu:925,bdquo:8222,lsquo:8216,apos:39,Beta:914,eacute:233,egrave:232,lceil:8968,Kappa:922,piv:982,Ccedil:199,ldquo:8220,Xi:926,cent:162,uarr:8593,hellip:8230,Aacute:193,ensp:8194,sect:167,Ugrave:217,aelig:230,ordf:170,curren:164,sbquo:8218,macr:175,Phi:934,Eta:919,rho:961,Omicron:927,sup2:178,euro:8364,aring:229,Theta:920,mdash:8212,uuml:252,otilde:245,eta:951,uacute:250,rArr:8658,nsub:8836,agrave:224,notin:8713,ndash:8211,Psi:936,Ocirc:212,sube:8838,szlig:223,micro:181,not:172,sup1:185,middot:183,iota:953,ecirc:234,lsaquo:8249,thinsp:8201,sum:8721,ntilde:241,scaron:353,cap:8745,atilde:227,lang:10216,__replacement:65533,isin:8712,gamma:947,Euml:203,ang:8736,upsilon:965,Ntilde:209,hearts:9829,Alpha:913,Tau:932,spades:9824,dagger:8224,THORN:222,"int":8747,lambda:955,Eacute:201,Uuml:220,infin:8734,rlm:8207,Aring:197,ugrave:249,Egrave:200,Acirc:194,rsaquo:8250,ETH:208,oslash:248,alpha:945,Ograve:210,Prime:8243,mu:956,ni:8715,real:8476,bull:8226,beta:946,icirc:238,eth:240,prod:8719,larr:8592,ordm:186,perp:8869,Gamma:915,reg:174,ucirc:251,Pi:928,psi:968,tilde:732,asymp:8776,zwnj:8204,Agrave:192,deg:176,AElig:198,times:215,Delta:916,sim:8764,Otilde:213,Mu:924,uArr:8657,circ:710,theta:952,Rho:929,sup3:179,diams:9830,tau:964,Chi:935,frac14:188,oelig:339,shy:173,or:8744,dArr:8659,phi:966,iuml:239,Lambda:923,rfloor:8971,iexcl:161,cong:8773,ccedil:231,Icirc:206,frac12:189,loz:9674,rarr:8594,cup:8746,radic:8730,frasl:8260,euml:235,OElig:338,hArr:8660,Atilde:195,Upsilon:933,there4:8756,ouml:246,oline:8254,Ecirc:202,yacute:253,auml:228,permil:8240,sigmaf:962,iquest:191,empty:8709,pi:960,Ucirc:219,supe:8839,Igrave:204,yen:165,rang:10217,trade:8482,lfloor:8970,minus:8722,Zeta:918,sub:8834,epsilon:949,yuml:255,Sigma:931,Iuml:207,ocirc:244};n.events.bind("getContent",function(t){return t.replace(/&(?:amp;)?(?!amp|lt|gt|quot)([a-z][a-z0-9]*);/gi,function(t,e){s[e]||(e=e.toLowerCase(),s[e]||(e="__replacement"));var i=s[e];return String.fromCharCode(i)})})}t(n.original).trigger("ready.jwysiwyg",[n.editorDoc,n])},this.innerDocument=function(){var t=this.editor.get(0);if("iframe"===t.nodeName.toLowerCase()){if(t.contentDocument)return t.contentDocument;if(t.contentWindow)return t.contentWindow.document;if(this.isDestroyed)return null;i.error("Unexpected error in innerDocument")}return t},this.insertHtml=function(e){var i,o;return e&&0!==e.length?(t.browser.msie?(this.ui.focus(),this.editorDoc.execCommand("insertImage",!1,"#jwysiwyg#"),i=this.getElementByAttributeValue("img","src","#jwysiwyg#"),i&&t(i).replaceWith(e)):t.browser.mozilla?1===t(e).length?(o=this.getInternalRange(),o.deleteContents(),o.insertNode(t(e).get(0))):this.editorDoc.execCommand("insertHTML",!1,e):this.editorDoc.execCommand("insertHTML",!1,e)||(this.editor.focus(),this.editorDoc.execCommand("insertHTML",!1,e)),this.saveContent(),this):this},this.parseControls=function(){var e=this;return t.each(this.options.controls,function(i,o){t.each(o,function(o){if(-1===t.inArray(o,e.availableControlProperties))throw i+'["'+o+'"]: property "'+o+'" not exists in Wysiwyg.availableControlProperties'})}),this.options.parseControls?this.options.parseControls.call(this):this.options.controls},this.removeFormat=function(){return t.browser.msie&&this.ui.focus(),this.options.removeHeadings&&this.editorDoc.execCommand("formatBlock",!1,"<p>"),this.editorDoc.execCommand("removeFormat",!1,null),this.editorDoc.execCommand("unlink",!1,null),t.wysiwyg.rmFormat&&t.wysiwyg.rmFormat.enabled&&("object"==typeof this.options.plugins.rmFormat.rmMsWordMarkup?t.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:this.options.plugins.rmFormat.rmMsWordMarkup}}):t.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:{enabled:!0}}})),this},this.ui.removeHoverClass=function(){t(this).removeClass("wysiwyg-button-hover")},this.resetFunction=function(){this.setContent(this.initialContent)},this.saveContent=function(){if(!this.viewHTML){if(this.original){var e,i;e=this.getContent(),this.options.rmUnwantedBr&&(e=e.replace(/<br\/?>$/,"")),this.options.replaceDivWithP&&(i=t("<div/>").addClass("temp").append(e),i.children("div").each(function(){var e,i=t(this),o=i.find("p");if(0===o.length){if(o=t("<p></p>"),this.attributes.length>0)for(e=0;e<this.attributes.length;e+=1)o.attr(this.attributes[e].name,i.attr(this.attributes[e].name));o.append(i.html()),i.replaceWith(o)}}),e=i.html()),t(this.original).val(e),this.options.events&&this.options.events.save&&this.options.events.save.call(this)}return this}},this.setContent=function(t){return this.editorDoc.body.innerHTML=t,this.saveContent(),this},this.triggerControl=function(t,e){var o=e.command||t,n=e.arguments||[];if(e.exec)e.exec.apply(this);else{this.ui.focus(),this.ui.withoutCss();try{this.editorDoc.execCommand(o,!1,n)}catch(s){i.error(s)}}this.options.autoSave&&this.autoSaveFunction()},this.triggerControlCallback=function(e){t(window).trigger("trigger-"+e+".wysiwyg",[this])},this.ui.withoutCss=function(){var e=this.self;if(t.browser.mozilla)try{e.editorDoc.execCommand("styleWithCSS",!1,!1)}catch(i){try{e.editorDoc.execCommand("useCSS",!1,!0)}catch(o){}}return e},this.wrapInitialContent=function(){var t=this.initialContent,e=t.match(/<\/?p>/gi);return e?t:"<p>"+t+"</p>"}}var i=window.console?window.console:{log:t.noop,error:function(e){t.error(e)}},o="prop"in t.fn&&"removeProp"in t.fn;t.wysiwyg={messages:{noObject:"Something goes wrong, check object"},addControl:function(e,i,o){return e.each(function(){var e,n=t(this).data("wysiwyg"),s={};return n?(s[i]=t.extend(!0,{visible:!0,custom:!0},o),t.extend(!0,n.options.controls,s),e=t(n.options.toolbarHtml),n.ui.toolbar.replaceWith(e),n.ui.toolbar=e,void n.ui.appendControls()):this})},clear:function(e){return e.each(function(){var e=t(this).data("wysiwyg");return e?void e.setContent(""):this})},console:i,destroy:function(e){return e.each(function(){var e=t(this).data("wysiwyg");return e?void e.destroy():this})},document:function(e){var i=e.data("wysiwyg");return i?t(i.editorDoc):void 0},getContent:function(t){var e=t.data("wysiwyg");return e?e.getContent():void 0},init:function(i,o){return i.each(function(){var i,n=t.extend(!0,{},o);"textarea"!==this.nodeName.toLowerCase()||t(this).data("wysiwyg")||(i=new e,i.init(this,n),t.data(this,"wysiwyg",i),t(i.editorDoc).trigger("afterInit.wysiwyg"))})},insertHtml:function(e,i){return e.each(function(){var e=t(this).data("wysiwyg");return e?void e.insertHtml(i):this})},plugin:{listeners:{},bind:function(e){var i=this;t.each(this.listeners,function(o,n){var s,r;for(s=0;s<n.length;s+=1)r=i.parseName(n[s]),t(e.editorDoc).bind(o+".wysiwyg",{plugin:r},function(i){t.wysiwyg[i.data.plugin.name][i.data.plugin.method].apply(t.wysiwyg[i.data.plugin.name],[e])})})},exists:function(e){var i;return"string"!=typeof e?!1:(i=this.parseName(e),t.wysiwyg[i.name]&&t.wysiwyg[i.name][i.method]?!0:!1)},listen:function(e,i){var o;return o=this.parseName(i),t.wysiwyg[o.name]&&t.wysiwyg[o.name][o.method]?(this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(i),!0):!1},parseName:function(t){var e;return"string"!=typeof t?!1:(e=t.split("."),2>e.length?!1:{name:e[0],method:e[1]})},register:function(e){return e.name||i.error("Plugin name missing"),t.each(t.wysiwyg,function(t){t===e.name&&i.error("Plugin with name '"+e.name+"' was already registered")}),t.wysiwyg[e.name]=e,!0}},removeFormat:function(e){return e.each(function(){var e=t(this).data("wysiwyg");return e?void e.removeFormat():this})},save:function(e){return e.each(function(){var e=t(this).data("wysiwyg");return e?void e.saveContent():this})},selectAll:function(t){var e,i,o,n=t.data("wysiwyg");return n?(e=n.editorDoc.body,void(window.getSelection?(o=n.getInternalSelection(),o.selectAllChildren(e)):(i=e.createTextRange(),i.moveToElementText(e),i.select()))):this},setContent:function(e,i){return e.each(function(){var e=t(this).data("wysiwyg");return e?void e.setContent(i):this})},triggerControl:function(e,o){return e.each(function(){var e=t(this).data("wysiwyg");return e?(e.controls[o]||i.error("Control '"+o+"' not exists"),void e.triggerControl.apply(e,[o,e.controls[o]])):this})},support:{prop:o},utils:{extraSafeEntities:[["<",">","'",'"'," "],[32]],encodeEntities:function(e){var i,o=this,n=[];return 0===this.extraSafeEntities[1].length&&t.each(this.extraSafeEntities[0],function(t,e){o.extraSafeEntities[1].push(e.charCodeAt(0))}),i=e.split(""),t.each(i,function(e){var s=i[e].charCodeAt(0);n.push(t.inArray(s,o.extraSafeEntities[1])&&(65>s||s>127||s>90&&97>s)?"&#"+s+";":i[e])}),n.join("")}}},t.wysiwyg.dialog=function(e,i){var o=e&&e.options&&e.options.dialog?e.options.dialog:i.theme?i.theme:"default",n=new t.wysiwyg.dialog.createDialog(o),s=this,r=t(s);return this.options={modal:!0,draggable:!0,title:"Title",content:"Content",width:"auto",height:"auto",open:!1,close:!1},this.isOpen=!1,t.extend(this.options,i),this.object=n,this.open=function(){this.isOpen=!0,n.init.apply(s,[]);var t=n.show.apply(s,[]);r.trigger("afterOpen",[t])},this.show=function(){this.isOpen=!0,r.trigger("beforeShow");n.show.apply(s,[]);r.trigger("afterShow")},this.hide=function(){this.isOpen=!1,r.trigger("beforeHide");var t=n.hide.apply(s,[]);r.trigger("afterHide",[t])},this.close=function(){this.isOpen=!1;var t=n.hide.apply(s,[]);r.trigger("beforeClose",[t]),n.destroy.apply(s,[]),r.trigger("afterClose",[t])},this.options.open&&r.bind("afterOpen",this.options.open),this.options.close&&r.bind("afterClose",this.options.close),this},t.extend(!0,t.wysiwyg.dialog,{_themes:{},_theme:"",register:function(e,i){t.wysiwyg.dialog._themes[e]=i},deregister:function(e){delete t.wysiwyg.dialog._themes[e]},createDialog:function(e){return new t.wysiwyg.dialog._themes[e]}}),t(function(){jQuery.ui&&t.wysiwyg.dialog.register("jqueryui",function(){var e=this;this._$dialog=null,this.init=function(){var i=this.options.content;"object"==typeof i&&("function"==typeof i.html?i=i.html():"function"==typeof i.toString&&(i=i.toString())),e._$dialog=t("<div></div>").attr("title",this.options.title).html(i);var o="auto"==this.options.height?300:this.options.height,n="auto"==this.options.width?450:this.options.width;
return e._$dialog.dialog({modal:this.options.modal,draggable:this.options.draggable,height:o,width:n}),e._$dialog},this.show=function(){return e._$dialog.dialog("open"),e._$dialog},this.hide=function(){return e._$dialog.dialog("close"),e._$dialog},this.destroy=function(){return e._$dialog.dialog("destroy"),e._$dialog}}),t.wysiwyg.dialog.register("default",function(){var e=this;this._$dialog=null,this.init=function(){var i=this,o=this.options.content;"object"==typeof o&&("function"==typeof o.html?o=o.html():"function"==typeof o.toString&&(o=o.toString())),e._$dialog=t('<div class="wysiwyg-dialog"></div>');var n=t('<div class="wysiwyg-dialog-topbar"><div class="wysiwyg-dialog-close-wrapper"></div><div class="wysiwyg-dialog-title">'+this.options.title+"</div></div>"),s=t('<a href="javascript:void(0);" class="wysiwyg-dialog-close-button">X</a>');s.click(function(){i.close()}),n.find(".wysiwyg-dialog-close-wrapper").prepend(s);var r=t('<div class="wysiwyg-dialog-content">'+o+"</div>");e._$dialog.append(n).append(r);var a="auto"==this.options.height?300:this.options.height,l="auto"==this.options.width?450:this.options.width;return e._$dialog.hide().css({width:l,height:a,left:(t(window).width()-l)/2,top:(t(window).height()-a)/3}),t("body").append(e._$dialog),e._$dialog},this.show=function(){if(this.options.modal&&e._$dialog.wrap('<div class="wysiwyg-dialog-modal-div"></div>'),this.options.draggable){var i=!1;e._$dialog.find("div.wysiwyg-dialog-topbar").bind("mousedown",function(e){e.preventDefault(),t(this).css({cursor:"move"});var o=t(this),n=t(this).parents(".wysiwyg-dialog"),s=e.pageX-parseInt(n.css("left"),10),r=e.pageY-parseInt(n.css("top"),10);i=!0,t(this).css({cursor:"move"}),t(document).bind("mousemove",function(t){t.preventDefault(),i&&n.css({top:t.pageY-r,left:t.pageX-s})}).bind("mouseup",function(e){e.preventDefault(),i=!1,o.css({cursor:"auto"}),t(document).unbind("mousemove").unbind("mouseup")})})}return e._$dialog.show(),e._$dialog},this.hide=function(){return e._$dialog.hide(),e._$dialog},this.destroy=function(){return this.options.modal&&e._$dialog.unwrap(),this.options.draggable&&e._$dialog.find("div.wysiwyg-dialog-topbar").unbind("mousedown"),e._$dialog.remove(),e._$dialog}})}),t.fn.wysiwyg=function(e){var o,n=arguments;return"undefined"!=typeof t.wysiwyg[e]?(n=Array.prototype.concat.call([n[0]],[this],Array.prototype.slice.call(n,1)),t.wysiwyg[e].apply(t.wysiwyg,Array.prototype.slice.call(n,1))):"object"!=typeof e&&e?t.wysiwyg.plugin.exists(e)?(o=t.wysiwyg.plugin.parseName(e),n=Array.prototype.concat.call([n[0]],[this],Array.prototype.slice.call(n,1)),t.wysiwyg[o.name][o.method].apply(t.wysiwyg[o.name],Array.prototype.slice.call(n,1))):void i.error("Method '"+e+"' does not exist on jQuery.wysiwyg.\nTry to include some extra controls or plugins"):(Array.prototype.unshift.call(n,this),t.wysiwyg.init.apply(t.wysiwyg,n))},t.fn.getWysiwyg=function(){return t.data(this,"wysiwyg")}}(jQuery);